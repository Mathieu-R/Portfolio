{"version":3,"file":"bundle.js","sources":["../../scripts/utils/utils.js","../../scripts/toast.js","../../scripts/sw-install.js","../../scripts/app.js"],"sourcesContent":["export function rafPromise() {\n  return new Promise(resolve => requestAnimationFrame(resolve));\n};\n\nexport function transitionEndPromise(el) {\n  return new Promise(resolve => {\n    const te = _ => {\n      el.removeEventListener('transitionend', te);\n      resolve();\n    }\n    el.addEventListener('transitionend', te);\n  });\n};\n\nexport function loadStyle(url) {\n  fetch(url)\n    .then(response => response.text())\n    .then(style => {\n      const link = document.createElement('link');\n      link.href = url;\n      document.head.appendChild(link);\n  });\n};\n\nexport function loadScript(url) {\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script');\n    script.src = url;\n    script.setAttribute('async', true);\n    script.onload = resolve;\n    script.onerror = reject;\n    document.body.appendChild(script);\n  });\n}\n\n","class Toast {\n  static Push(message) {\n    const container = document.querySelector('.toast-container');\n    const toast = document.createElement('div');\n    const toastContent = document.createElement('p');\n    toast.classList.add('toast');\n    toastContent.classList.add('toast-content');\n    toastContent.textContent = message;\n\n    container.appendChild(toast);\n    toast.appendChild(toastContent);\n\n    setTimeout(() => toast.classList.add('hide'), 3000);\n    toast.addEventListener('transitionend', evt => evt.target.parentNode.removeChild(evt.target));\n  }\n}\n\nexport default Toast;\n","import Toast from './toast.js';\n\nexport function serviceWorkerInstall() {\n  if (!('serviceWorker' in navigator)) {\n    return;\n  }\n\n  navigator.serviceWorker.onmessage = evt => {\n    if (evt.data.type === 'version') {\n      console.log(`Service Worker updated to version ${evt.data.version}`);\n      Toast.Push('Portfolio updated. Refresh to get the new version.');\n      return;\n    }\n\n    if (evt.data.type === 'cached') {\n      Toast.Push('Portfolio cached. Future visit will work offline !');\n      return;\n    }\n  };\n\n  navigator.serviceWorker.register('/sw.js', {'scope': '/'})\n    .then(reg => {\n      reg.onupdatefound = evt => {\n        console.log('A new service worker has been found, installing...');\n\n        reg.installing.onstatechange = evt => {\n          // as the service worker is installed, we can push the message\n          if (evt.target.state === 'activated') {\n            reg.active.postMessage('version');\n          }\n          console.log(`Service Worker ${evt.target.state}`)\n        }\n      }\n    })\n    .catch(error => console.warn(error));\n}\n","import {loadScript} from './utils/utils.js';\nimport {serviceWorkerInstall} from './sw-install.js';\nimport Toast from './toast.js';\n\nclass App {\n  constructor() {\n    this.currentPath = window.location.pathname;\n    this.links = Array.from(document.querySelectorAll('.nav-link'));\n    this.pageContent = document.querySelector('.content');\n\n    this.onClickLinks = this.onClickLinks.bind(this);\n    this.onChanged = this.onChanged.bind(this);\n    this.loadView = this.loadView.bind(this);\n    this.swapContent = this.swapContent.bind(this);\n    this.hideAreas = this.hideAreas.bind(this);\n\n    serviceWorkerInstall();\n    this.initCustomElements();\n    this.addEventListeners();\n  }\n\n  initCustomElements () {\n    if (!('customElements' in window)) {\n      loadScript('/static/js/third_party/webcomponents-lite.js').then(_ => {\n        console.log('custom-elements polyfill added.');\n      });\n    }\n  }\n\n  loadView(url) {\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.open('GET', url, 'true');\n      xhr.onload = evt => {\n        const newView = evt.target.response;\n        resolve(newView);\n      }\n      xhr.onerror = reject;\n      xhr.responseType = 'document';\n      xhr.send();\n    });\n  }\n\n  swapContent(view) {\n    this.hideAreas().then(_ => {\n      this.pageContent.removeEventListener('transitionend', this.onSwapTransitionEnd);\n\n      const currentMasthead = document.querySelector('.masthead');\n      const currentContent = document.querySelector('.content');\n\n      const newMasthead = view.querySelector('.masthead');\n      const newContent = view.querySelector('.content');\n\n      // TODO: rework this code\n      if (newMasthead) {\n        if (currentMasthead) {\n          currentMasthead.innerHTML = newMasthead.innerHTML;\n          currentMasthead.className = newMasthead.className;\n        } else {\n          document.body.insertBefore(newMasthead, currentContent);\n        }\n      } else if (!newMasthead && currentMasthead) {\n        document.body.removeChild(currentMasthead);\n      }\n\n      currentContent.innerHTML = newContent.innerHTML;\n      currentContent.className = newContent.className\n\n      // double rAF\n      requestAnimationFrame(_ => {\n        requestAnimationFrame(_ => {\n          document.body.classList.remove('hide');\n        });\n      });\n    });\n  }\n\n  hideAreas() {\n    return new Promise((resolve, reject) => {\n      this.pageContent.addEventListener('transitionend', resolve);\n      document.body.classList.add('hide');\n    });\n  }\n\n  onChanged() {\n    this.newPath = window.location.pathname;\n\n    if (this.currentPath === this.newPtath) {\n      return;\n    }\n    this.currentPath = this.newPath;\n\n    this.loadView(this.newPath)\n      .then(view => this.swapContent(view))\n      .catch(error => console.warn(error));\n  }\n\n  onClickLinks(evt) {\n    evt.preventDefault();\n    history.pushState(null, null, evt.target.href);\n    this.onChanged();\n  }\n\n  addEventListeners() {\n    this.links.forEach(link => link.addEventListener('click', this.onClickLinks));\n    window.addEventListener('popstate', this.onChanged);\n  }\n}\n\nwindow.addEventListener('load', _ => new App());\n"],"names":["loadScript","url","Promise","resolve","reject","script","document","createElement","src","setAttribute","onload","onerror","body","appendChild","Toast","Push","message","container","querySelector","toast","toastContent","classList","add","textContent","addEventListener","evt","target","parentNode","removeChild","serviceWorkerInstall","navigator","serviceWorker","onmessage","data","type","log","version","register","then","reg","onupdatefound","installing","onstatechange","state","active","postMessage","catch","error","console","warn","App","currentPath","window","location","pathname","links","Array","from","querySelectorAll","pageContent","onClickLinks","bind","onChanged","loadView","swapContent","hideAreas","initCustomElements","addEventListeners","_","xhr","XMLHttpRequest","open","newView","response","responseType","send","view","removeEventListener","onSwapTransitionEnd","currentMasthead","currentContent","newMasthead","newContent","innerHTML","className","insertBefore","remove","newPath","newPtath","preventDefault","pushState","href","forEach","link"],"mappings":"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"}